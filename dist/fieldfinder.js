(()=>{"use strict";({"./src/fieldfinder.ts":function(e,t){var i,s,d=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(d,n){function l(e){try{r(s.next(e))}catch(e){n(e)}}function o(e){try{r(s.throw(e))}catch(e){n(e)}}function r(e){var t;e.done?d(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(l,o)}r((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.FieldFinderDropdownOption=t.FieldFinderDropdown=t.handleRelatedTableClick=t.handleKey=t.handleMultiSelectClick=t.handleFieldSelectorClick=t.handleButtonClick=t.handleFieldUpdate=t.initializeFieldFinder=t.relatedTableDataIds=t.FieldType=void 0;var n,l,o=-1;!function(e){e[e.dataType=104]="dataType",e[e.fieldType=112]="fieldType",e[e.fieldName=280]="fieldName",e[e.fieldId=280]="fieldId",e[e.multiFunction=24]="multiFunction"}(n||(n={})),function(e){e.RELATED="Related Fields",e.CUSTOM="Custom Field",e.CUSTOM_BODY="Custom Body",e.CUSTOM_COLUMN="Custom Column",e.STANDARD="Standard Field"}(l||(t.FieldType=l={}));const r=["rffield","filterfilter","sort1","sort2","sort3","field","dffield","fffilter"],a=["returnfields","filterfields","detailfields"];function h(){var e,t;performance.now();try{const e=document.getElementById("field-finder-settings");i=JSON.parse(e.getAttribute("data-options")||"")}catch(e){return void console.error(`Could not parse Field Finder settings, so not loading. ${e}`)}if(0!=i.enabled){if(i.features.multiSelect&&(i.features.multiSelect=!NS.Core.getURLParameter("ifrmcntnr")),i.features.multiSelect)for(const e in machines)if(a.includes(e)){let t=machines[e];t.postBuildTableListeners&&(t.postBuildTableListeners.push((function(){p(t)})),t.buildtable())}if(s=(null===(e=document.getElementById("searchtype"))||void 0===e?void 0:e.value)||NS.Core.getURLParameter("searchtype"),o=(null===(t=document.getElementById("rectype"))||void 0===t?void 0:t.value)||NS.Core.getURLParameter("rectype")||-1,null!=typeof dropdowns)for(let e in dropdowns)r.includes(dropdowns[e].name)&&(dropdowns[e].fieldFinder=new T(dropdowns[e],s,o,i))}}function p(e){const t=e.layoutdd.fieldFinder;t&&t.refreshMultiSelectOptions()}function c(e,t){e.toggleFieldTypeFilter(t)}function u(e){e.nsDropdown.getIndex()||e.reset(),e.setFocusOnTextBox()}function f(e,t){e.selectField(t)}function m(e,t,i){"keyup"==t&&"Enter"==e||"Tab"==e?i.handleEnterOrTabKey():"keyup"==t&&(1==e.length&&e.match(/[a-zA-Z0-9]/)||"Backspace"==e)?i.handleAlphaNumericKey():"keydown"!=t||"ArrowDown"!=e&&"ArrowUp"!=e||i.handleArrowKey(e)}function y(e,t){return d(this,void 0,void 0,(function*(){yield e.addRelatedTableFields(t)}))}t.relatedTableDataIds={filters:"fffilter",returnfields:"rffield",summaryfilters:"filterfilter",detailfields:"dffield",filterfields:"fffilter",field:"field"},"undefined"!=typeof NS&&(NS.form.isInited()?h():NS.event.once(NS.event.type.FORM_INITED,h)),t.initializeFieldFinder=h,t.handleFieldUpdate=p,t.handleButtonClick=c,t.handleFieldSelectorClick=u,t.handleMultiSelectClick=f,t.handleKey=m,t.handleRelatedTableClick=y;class T{constructor(e,t,i,s){return this.fieldsTotal=0,this.fieldsDisplayed=0,this.multiSelect=!1,this.fieldTypeStatus={standardFields:!1,relatedTableFields:!1,customFields:!1},this.searchInputField=document.createElement("input"),this.fieldFinderElement=document.createElement("div"),this.footer=document.createElement("div"),this.relatedTablesAdded=[],this.options=[],this.selectedOptions=[],this.customOptions=[],this.standardOptions=[],this.relatedOptions=[],this.hasRelatedTableFields=!1,this.hasCustomFields=!1,this.buttons={},this.hasMachine=!1,this.nsDropdown=e,this.settings=s,this.searchType=t,this.recType=i,this.init(),this}init(){var e,t;a.includes(null===(t=null===(e=this.nsDropdown.hddn)||void 0===e?void 0:e.machine)||void 0===t?void 0:t.name)&&(this.hasMachine=!0),this.nsDropdown.div||this.nsDropdown.buildDiv(),this.setDropdownWidth(),this.enableMultiSelectIfAvailable(),this.configureFieldClickHandler(),this.prepareDropdownOptions(),this.addFieldFinderFilterElements(),this.addFieldFinderFooterElement(),this.configureAutoFocusOnTextBox()}enableMultiSelectIfAvailable(){this.hasMachine&&(this.multiSelect=!0)}prepareDropdownOptions(){this.options=[],this.nsDropdown.valueArray.forEach(((e,t)=>{let i=new v(this,t);return this.options.push(i),i.fieldType==l.CUSTOM||i.fieldType==l.CUSTOM_BODY||i.fieldType==l.CUSTOM_COLUMN?(this.customOptions.push(i),this.hasCustomFields=!0):i.fieldType==l.RELATED?(this.relatedOptions.push(i),this.hasRelatedTableFields=!0):this.standardOptions.push(i),!0}))}softReload(){this.setDropdownWidth(),this.prepareDropdownOptions(),this.nsDropdown.div.insertBefore(this.fieldFinderElement,this.nsDropdown.div.childNodes[0]),this.nsDropdown.div.appendChild(this.footer)}configureFieldClickHandler(){var e;this.nsDropdown.inpt.addEventListener("click",(()=>{u(this)})),null===(e=document.getElementById(`${this.nsDropdown.inpt.id}_arrow`))||void 0===e||e.addEventListener("click",(()=>{u(this)}))}createFilterButton(e,t){const i=document.createElement("button");return i.setAttribute("onpointerdown","event.preventDefault();"),i.setAttribute("id",e),i.setAttribute("type","button"),i.setAttribute("value","0"),i.innerText=t,i.addEventListener("click",(()=>{c(this,i)})),i}toggleFieldTypeFilter(e){const t=e.classList.toggle("ff_btn_enabled"),i=e.id;this.fieldTypeStatus[i]=t,this.nsDropdown.respondToArrow(0-this.nsDropdown.indexOnDeck),this.setFocusOnTextBox(),this.filterDropdown()}setFocusOnTextBox(){var e;null===(e=this.searchInputField)||void 0===e||e.focus()}configureAutoFocusOnTextBox(){this.nsDropdown.inpt.addEventListener("focus",(e=>{this.setFocusOnTextBox()}))}setDropdownWidth(){var e=800;this.settings.attributes.dataType||(e-=n.dataType),this.settings.attributes.fieldType||(e-=n.fieldType),this.settings.attributes.fieldId||(e-=n.fieldId),e=e<400?400:e,this.nsDropdown.div.style.setProperty("width",`${e}px`),this.nsDropdown.div.style.setProperty("margin-bottom","25px"),this.nsDropdown.div.style.setProperty("margin-top","32px")}addButtons(){const e=document.createElement("div");e.setAttribute("class","ff_btn_group"),e.setAttribute("id","ff_btn_group"),e.style.setProperty("padding-left","20px"),this.buttons.standard=e.appendChild(this.createFilterButton("standardFields","Standard")),this.hasCustomFields&&(this.buttons.custom=e.appendChild(this.createFilterButton("customFields","Custom"))),this.hasRelatedTableFields&&(this.buttons.related=e.appendChild(this.createFilterButton("relatedTableFields","Related"))),this.fieldFinderElement.appendChild(e)}addTextBox(){this.searchInputField.classList.add("ff_textbox"),this.searchInputField.setAttribute("placeholder","Filter by Name or ID"),this.searchInputField.setAttribute("type","text"),this.searchInputField.setAttribute("id","ff_show_search_input"),this.searchInputField.setAttribute("onmouseup","event.stopPropagation();this.focus();"),this.searchInputField.setAttribute("ondblclick","event.preventDefault();this.select();"),this.searchInputField.setAttribute("onclick","event.preventDefault();this.select()"),this.searchInputField.setAttribute("autocomplete","off"),this.searchInputField.addEventListener("keydown",(e=>{e.stopPropagation(),m(e.key,e.type,this)})),this.searchInputField.addEventListener("keyup",(e=>{e.stopPropagation(),m(e.key,e.type,this)})),this.searchInputField.addEventListener("keypress",(e=>{e.stopPropagation()})),this.fieldFinderElement.appendChild(this.searchInputField)}addFieldFinderFilterElements(){this.fieldFinderElement.classList.add("ff_div"),this.fieldFinderElement.setAttribute("onclick","event.preventDefault();"),this.fieldFinderElement.setAttribute("onpointerdown","event.preventDefault();"),this.addTextBox(),this.addButtons(),this.nsDropdown.div.insertBefore(this.fieldFinderElement,this.nsDropdown.div.childNodes[0])}addFieldFinderFooterElement(){const e=document.createElement("div"),t=document.createElement("span"),i=document.createElement("span"),s=document.createElement("a");e.setAttribute("id","footerDiv"),e.classList.add("ff_div_footer"),t.setAttribute("id","ffFilterStatus"),t.classList.add("ff_status"),e.appendChild(t),i.setAttribute("id","ffTitle"),i.classList.add("ff_title"),i.textContent="",s.href="https://chrome.google.com/webstore/detail/netsuite-field-finder/npehdolgmmdncpmkoploaeljhkngjbne?hl=en-US&authuser=0",s.title="NetSuite Field Finder 0.26",s.textContent="NetSuite Field Finder 0.26",s.setAttribute("onpointerdown",`event.preventDefault();event.stopImmediatePropagation();window.open('${s.href}','_blank');`),s.setAttribute("onmousedown","event.preventDefault();event.stopImmediatePropagation();"),s.setAttribute("onclick","event.preventDefault();event.stopImmediatePropagation();"),i.appendChild(s),e.appendChild(i),this.footer=this.nsDropdown.div.appendChild(e)}selectField(e){var t;const i=null===(t=this.nsDropdown.hddn)||void 0===t?void 0:t.machine;if(!i)return;const s=i.dataManager.findFieldValueLineNum({detailfields:"dffield",returnfields:"rffield",filterfields:"field"}[i.name],e);-1==s?(i.insertLine([e,"","","","","",""],i.getLineCount()+1),i.incrementIndex(),i.setMachineIndex(i.getLineCount()+1)):(i.deleteline(s,!0),i.setMachineIndex(i.getLineCount()+1),i.clearline()),i.buildtable()}showNumberOfFieldsDisplayed(){this.footer.childNodes[0].textContent=`Showing ${this.fieldsDisplayed} of ${this.fieldsTotal} fields.`}reset(){var e,t,i;this.searchInputField.value="",null===(e=this.buttons.custom)||void 0===e||e.classList.remove("ff_btn_enabled"),null===(t=this.buttons.related)||void 0===t||t.classList.remove("ff_btn_enabled"),null===(i=this.buttons.standard)||void 0===i||i.classList.remove("ff_btn_enabled"),this.fieldTypeStatus.customFields=!1,this.fieldTypeStatus.relatedTableFields=!1,this.fieldTypeStatus.standardFields=!1,this.filterDropdown()}filterDropdown(){this.fieldsDisplayed=0,this.fieldsTotal=0,this.options.forEach((e=>(this.fieldsTotal++,e.filterOption(),e.hidden||this.fieldsDisplayed++,!0))),this.showNumberOfFieldsDisplayed()}getSelectedFields(){return this.nsDropdown.hddn.machine.dataManager.getLineArray().map((e=>e[0]))}refreshMultiSelectOptions(){const e=this.getSelectedFields();for(let e of this.selectedOptions)e.unselect();this.selectedOptions=[];for(let t of e){const e=this.nsDropdown.valueToIndexMap[t],i=this.options[e];i.select(),this.selectedOptions.push(i)}}relatedTableUrl(e,t){return{filters:`/app/common/search/search.nl?join=${t}&searchtype=${this.searchType}&ifrmcntnr=T&rectype=${this.recType}`,returnfields:`/app/common/search/search.nl?resultjoin=${t}&sel=returnfields&mach=returnfields&searchtype=${this.searchType}&ifrmcntnr=T&rectype=${this.recType}`,summaryfilters:`/app/common/search/search.nl?resultjoin=${t}&sel=filterfilter&mach=summaryfilters&searchtype=${this.searchType}&ifrmcntnr=T&rectype=${this.recType}`,field:`/app/common/search/search.nl?formulajoin=${t}&filterformula=T&field=formula&useids=F&searchtype=${this.searchType}&ifrmcntnr=T&rectype=${this.recType}`,detailfields:`/app/common/search/search.nl?resultjoin=${t}&sel=dffield&mach=detailfields&searchtype=${this.searchType}&ifrmcntnr=T&rectype=${this.recType}`,filterfields:`/app/common/search/search.nl?ffjoin=${t}&searchtype=${this.searchType}&rectype=${this.recType}&ifrmcntnr=T`}[e]}getRelatedTableLabelName(e){return e.querySelector("input[id='joinlabel']").value}getRelatedTableFields(e){var i,s;const d=(null===(s=null===(i=this.nsDropdown.hddn)||void 0===i?void 0:i.machine)||void 0===s?void 0:s.name)||this.nsDropdown.name,n=t.relatedTableDataIds[d],l=e.querySelector(`div[data-name='${n}']`);return JSON.parse(l.getAttribute("data-options")||"")}getRelatedTableDetails(e){var t,i;return d(this,void 0,void 0,(function*(){const s=(null===(i=null===(t=this.nsDropdown.hddn)||void 0===t?void 0:t.machine)||void 0===i?void 0:i.name)||this.nsDropdown.name,d=this.relatedTableUrl(s,e.replace(/^\_/,"")),n=yield fetch(d);if(200!=n.status)throw new Error("HTTP error while retrieving related fields.");const l=yield n.text(),o=(new DOMParser).parseFromString(l,"text/html")||"";return{fields:this.getRelatedTableFields(o),labelName:this.getRelatedTableLabelName(o)}}))}addRelatedTableFields(e){var t,i;return d(this,void 0,void 0,(function*(){var s;const d=(null===(i=null===(t=this.nsDropdown.hddn)||void 0===t?void 0:t.machine)||void 0===i?void 0:i.name)||this.nsDropdown.name;if(this.relatedTablesAdded.includes(`${d}_${e}`))return!1;const n=this.nsDropdown.getIndexForValue(e);if(!n)return!1;try{s=yield this.getRelatedTableDetails(e)}catch(e){return console.error(`An error occurred while trying to retrieve related fields: ${e}`),!1}this.nsDropdown.close();for(let e of s.fields)""!=e.value&&this.nsDropdown.addOption(`${s.labelName} : ${e.text}`,e.value,n+1);return this.relatedTablesAdded.push(`${d}_${e}`),this.nsDropdown.buildDiv(),this.softReload(),this.nsDropdown.open(),this.nsDropdown.setCurrentCellInMenu(this.nsDropdown.divArray[n]),this.nsDropdown.currentCell.scrollIntoView(!0),!0}))}handleEnterOrTabKey(){const e=this.nsDropdown.indexOnDeck||0;this.nsDropdown.setAndClose(e)}handleArrowKey(e){const t=this.nsDropdown.indexOnDeck||0;if(0==t&&"ArrowUp"==e)return;let i="ArrowDown"==e?t+1:t-1,s=this.options[i];for(;s;){if(!s.hidden){this.nsDropdown.respondToArrow(i-t);break}i="ArrowDown"==e?i+1:i-1,s=this.options[i]}}handleAlphaNumericKey(){this.filterDropdown(),this.nsDropdown.respondToArrow(0-this.nsDropdown.indexOnDeck)}}t.FieldFinderDropdown=T;class v{constructor(e,t){return this.element=e.nsDropdown.div.childNodes[t],this.dropdown=e,this.index=t,this.hidden=!1,this.fieldIdElement=document.createElement("span"),this.fieldNameElement=document.createElement("span"),this.fieldTypeElement=document.createElement("span"),this.dataTypeElement=document.createElement("span"),this.multiEditElement=document.createElement("span"),this.fieldId=e.nsDropdown.valueArray[t],this.fieldName=e.nsDropdown.textArray[t].replace(/\((Custom Body|Custom Column|Custom)\)/i,""),this.fieldType=this.getFieldType(),this.buildOptionElements(),this}buildOptionElements(){this.element.removeChild(this.element.childNodes[0]),this.addMultiFunctionElement(),this.addFieldNameElement();const e=this.dropdown.settings.attributes;e.fieldId&&this.addFieldIdElement(),e.fieldType&&this.addFieldTypeElement(),e.dataType&&this.addDataTypeElement(),1==this.dropdown.multiSelect&&""!=this.fieldId&&"Related Fields"!=this.fieldType&&this.enableMultiSelect(),this.dropdown.settings.features.relatedTableExpansion&&"Related Fields"==this.fieldType&&this.enableRelatedFieldsExpansion()}select(){this.multiEditElement.classList.add("ff_multiedit_selected")}unselect(){this.multiEditElement.classList.remove("ff_multiedit_selected")}prettyFieldId(){var e=["stdentity","stdbody","custom_","transaction_"];return this.dropdown.searchType&&e.push(`${this.dropdown.searchType.toLowerCase()}_`),this.fieldId.toLowerCase().replace(new RegExp(`(${e.join("|")})`),"")}getFieldType(){let e=this.fieldId.toLowerCase();return e.match(/^(custbody)/)?l.CUSTOM_COLUMN:e.match(/^(custcol)/)?l.CUSTOM_BODY:e.match(/^(custcol|custrecord|custentity|custitem)/)?l.CUSTOM:this.fieldName.endsWith("Fields...")?l.RELATED:l.STANDARD}addMultiFunctionElement(){this.multiEditElement.style.setProperty("width",`${n.multiFunction}px`),this.multiEditElement.classList.add("ff_option"),this.multiEditElement.style.setProperty("text-align","center"),this.element.appendChild(this.multiEditElement)}addFieldIdElement(){this.fieldIdElement.classList.add("ff_option"),this.fieldIdElement.style.setProperty("width",`${n.fieldId}px`),this.fieldIdElement.textContent="Related Fields"==this.fieldType?"":this.prettyFieldId()||"",this.fieldIdElement.style.visibility=this.dropdown.settings.attributes.fieldId?"visible":"hidden",this.element.appendChild(this.fieldIdElement)}addFieldNameElement(){this.fieldNameElement.classList.add("ff_option"),this.fieldNameElement.style.setProperty("width",`${n.fieldName}px`),this.fieldNameElement.textContent=this.fieldName,this.element.appendChild(this.fieldNameElement)}addFieldTypeElement(){this.fieldTypeElement.classList.add("ff_option"),this.fieldTypeElement.style.setProperty("width",`${n.fieldType}px`),this.fieldTypeElement.textContent=this.fieldType,this.fieldTypeElement.style.visibility=this.dropdown.settings.attributes.fieldType?"visible":"hidden",this.element.appendChild(this.fieldTypeElement)}addDataTypeElement(){this.dataTypeElement.classList.add("ff_option"),this.dataTypeElement.style.setProperty("width",`${n.dataType}px`),"fffilter"==this.dropdown.nsDropdown.name&&"object"==typeof ffTypes||"filterfilter"==this.dropdown.nsDropdown.name&&"object"==typeof ffTypes?this.dataTypeElement.textContent=ffTypes[this.fieldId]:"rffield"==this.dropdown.nsDropdown.name&&"object"==typeof rfTypes?this.dataTypeElement.textContent=rfTypes[this.fieldId]:this.dataTypeElement.textContent="",this.dataTypeElement.style.visibility=this.dropdown.settings.attributes.dataType?"visible":"hidden",this.element.appendChild(this.dataTypeElement)}enableMultiSelect(){this.multiEditElement.classList.add("ff_multiedit"),this.multiEditElement.setAttribute("onmouseup","event.preventDefault();event.stopImmediatePropagation();"),this.multiEditElement.setAttribute("onclick","event.preventDefault();event.stopImmediatePropagation();"),this.multiEditElement.addEventListener("pointerup",(()=>{f(this.dropdown,this.fieldId)}))}enableRelatedFieldsExpansion(){var e,t;this.dropdown.relatedTablesAdded.includes(`${null===(t=null===(e=this.dropdown.nsDropdown.hddn)||void 0===e?void 0:e.machine)||void 0===t?void 0:t.name}_${this.fieldId}`)?this.multiEditElement.classList.add("ff_expandrelated_added"):this.multiEditElement.classList.add("ff_expandrelated"),this.multiEditElement.setAttribute("onmouseup","event.preventDefault();event.stopImmediatePropagation();"),this.multiEditElement.setAttribute("onclick","event.preventDefault();event.stopImmediatePropagation();"),this.multiEditElement.addEventListener("pointerup",(e=>{y(this.dropdown,this.fieldId)}))}filterOption(){this.filterOnFieldType(),this.hidden||this.filterOnTextString()}filterOnFieldType(){const e=this.dropdown.fieldTypeStatus.customFields,t=this.dropdown.fieldTypeStatus.relatedTableFields,i=this.dropdown.fieldTypeStatus.standardFields;1!=new Set([e,t,i]).size?this.fieldType==l.RELATED?t?this.show():this.hide():this.fieldType==l.CUSTOM||this.fieldType==l.CUSTOM_BODY||this.fieldType==l.CUSTOM_COLUMN?e?this.show():this.hide():this.fieldType==l.STANDARD&&(i?this.show():this.hide()):this.show()}filterOnTextString(){const e=this.dropdown.searchInputField.value;if(!e)return void this.resetOptionToOriginal();const t=new RegExp(e,"gi");-1!=(this.fieldName||"").search(t)||this.dropdown.settings.attributes.fieldId&&-1!=(this.fieldId||"").search(t)?(this.highlightMatchedText(),this.show()):(this.hide(),this.resetOptionToOriginal())}highlightMatchedText(){const e=this.dropdown.searchInputField.value,t=new RegExp(e,"gi");this.fieldName&&""!=e&&(this.fieldNameElement.innerHTML=(this.fieldName||"").replace(t,'<mark class="highlight">$&</mark>'),this.fieldType!=l.RELATED&&this.dropdown.settings.attributes.fieldId&&(this.fieldIdElement.innerHTML=this.prettyFieldId().replace(t,'<mark class="highlight">$&</mark>')))}resetOptionToOriginal(){this.fieldNameElement.innerHTML=this.fieldName||"",this.fieldType!=l.RELATED&&(this.fieldIdElement.innerHTML=this.prettyFieldId())}hide(){this.element.style.setProperty("display","none"),this.hidden=!0}show(){this.element.style.setProperty("display","block"),this.hidden=!1}}t.FieldFinderDropdownOption=v}})["./src/fieldfinder.ts"](0,{})})();